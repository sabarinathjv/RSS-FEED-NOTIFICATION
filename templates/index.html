{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>events site</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="{% static 'css/styles.css'%}" rel="stylesheet" />
        <style>
            
            .button {
              background-color: #4CAF50;
              border: none;
              color: white;
              padding: 15px 32px;
              text-align: center;
              text-decoration: none;
              display: inline-block;
              font-size: 16px;
              margin: 4px 2px;
              cursor: pointer;
            }
            </style>
    </head>
  
    <body>
        

        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container px-4 px-lg-5">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#!">Welcome {{request.user}}</a></li>                  
                    </ul>              
                    <form class="container-fluid justify-content-start">
                        <button class="btn btn-outline-success me-2" id="logout_btn" type="button">Log out</button>                       
                      </form>
                </div>
            </div>
        </nav>
        <!-- Header-->
        <header class="bg-dark py-5">
            <div class="container px-4 px-lg-5 my-5">
                <div class="text-center text-white">
                    <h1 class="display-4 fw-bolder">Welcome to feeder !</h1>
                </div>
            </div>
        </header>
        <!-- Section-->
        <section class="py-5">
              <div class="input-group mb-3">
                <input type="text" class="form-control"  id="search_id" placeholder="Enter the link" aria-label="Recipient's username" aria-describedby="basic-addon2">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary"id="search_button" type="button">Subscribe</button>
                </div>
              </div>
        </section >

        <blockquote class="blockquote text-center">
            <p class="mb-0">My subscribtions</p>
          </blockquote>
   


        <section class="py-5">
            <div class="container px-4 px-lg-5 mt-5">
                <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                    {%  for  i in results %}
                    <div class="col mb-5">                   
                        <div class="card h-100">
                            <!-- Product image-->
                            <img class="card-img-top" src="{% static 'assets/default.jpg' %}" alt="..." />
                            <!-- Product details-->
                            <div class="card-body p-4">
                                <div class="text-center">
                                    <!-- Product name-->
                                    <h4 class="fw-bolder">{{i.title}}</h4>
                               
                                                            
                                </div>
                            </div>
                            <!-- Product actions-->
                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                                <div class="text-center">
                                <button type="button" id="{{i.id}}"  onclick="Liked('{{i.id}}')"  class="btn btn-secondary">Subscribed</button>
                            </div>
                            </div>
                        </div>                     
                    </div>
                    {% endfor %}

                </div>
            </div>
        </section>

        <blockquote class="blockquote text-center">
            <p class="mb-0">Top Feeds</p>
          </blockquote>

          <section class="py-5">
            <div class="container px-4 px-lg-5 mt-5">
                <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                    {%  for  i in top_sub %}
                    <div class="col mb-5">                   
                        <div class="card h-100">
                            <!-- Product image-->
                            <img class="card-img-top" src="{% static 'assets/default.jpg' %}" alt="..." />
                            <!-- Product details-->
                            <div class="card-body p-4">
                                <div class="text-center">
                                    <!-- Product name-->
                                    <h4 class="fw-bolder">{{i.title}}</h4>
                                                               
                                </div>
                            </div>
                            <!-- Product actions-->
                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                                <div class="text-center">
                                <button type="button" id="{{i.id}}" onclick="Liked('{{i.id}}')"  class="btn btn-success">Subscribe</button>
                            </div>
                            </div>
                        </div>                     
                    </div>
                    {% endfor %}

                </div>
            </div>
        </section>


        
        <!-- Footer-->
        <footer class="py-5 bg-dark">
            <div class="container"><p class="m-0 text-center text-white">Copyright @ 2021&copy; All Rights Reserved</p></div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="{% static 'js/scripts.js'%}"></script>    
        <script type="text/javascript">
            $(function() {
                $('#datepicker').datepicker();
            });
        </script>

        <script type="text/javascript">
            $(function() {
                $('#datepickers').datepicker();
            });
        </script>

        <script type="text/javascript">  //flag
            document.getElementById("search_button").onclick = function () {
                
                var search = $("#search_id").val()
                var token = '{{csrf_token}}'
                //var data = '?search=0'.replace('0',search)
                //location.href = data
                
                fetch("{% url 'add-link' %}", {
                    method: 'post',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',"X-CSRFToken":token
                    },
                    body: JSON.stringify({
                        "link":search,
                   
               
                                    })
                    }).then(function(res){ return res.json(); })
                    .then(function(data){          
                        if(data.data=="True"){
                            alert(data.message) 
                         location.href = "{% url 'events' %}"
                           
                          
                        }
                        else{
                            alert(data.message)        
                        }
                    });
            };
        </script>

        <script type="text/javascript">  //flag
            document.getElementById("filter_button").onclick = function () {
                
                var start_date = $("#start_date").val()
                var end_date = $("#end_date").val()
                var category = $("#category").val()
                if(start_date =="" | end_date==""  | category=="" )
                {
                    alert("please provide all the fields for filtering")
                    return

                }
                var start_date  = start_date.replaceAll("/", "-");
                var end_date  = end_date.replaceAll("/", "-");
            
                var data = "filter" +'/' + start_date +'/' + end_date +'/' + category
                location.href = data
            };
        </script>


        <script type="text/javascript">  
            document.getElementById("next_id").onclick = function () {
           
                if("{{next}}" !== 'None'){
                    location.href = "{{next}}"

                }
                               
            };
        </script>

        <script type="text/javascript">  
            document.getElementById("previous_id").onclick = function () {
           
                if("{{previous}}" !== 'None'){
                    location.href = "{{previous}}"

                }
                               
            };
        </script>

        <script>
                   
            var token = '{{csrf_token}}'
            $(document).ready(function() {
                $("#logout_btn").click(function() { 
   
                        fetch("{% url 'user-logout' %}", {
                method: 'post',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',"X-CSRFToken":token
                },
                body: JSON.stringify({
                    "logout":"logout",
               
           
                                })
                }).then(function(res){ return res.json(); })
                .then(function(data){          
                    if(data.data=="True"){
                     location.href = "{% url 'user-login' %}"
                       
                      
                    }
                    else{
                        alert(data.message)        
                    }
                });
                });
                });
         </script>

         <script>
            function Liked(event_id){
                
                var my_div = $( "#"+event_id)
                var temp = $( "#"+event_id).attr('class')
             
                
                // 
                //
              
             
               fetch("{% url 'like-fetcher' %}", {
                method: 'post',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',"X-CSRFToken":token
                },
                body: JSON.stringify({
                    "event_id":event_id,

               
           
                                })
                }).then(function(res){ return res.json(); })
                .then(function(data){          
                    if(data.data=="True"){
                        if(temp=="btn btn-secondary"){
                            my_div.removeClass("btn btn-secondary");
                            my_div.addClass("btn btn-success");
                            my_div.text('Subscribe');
                        }
                        else {
                            my_div.removeClass("btn btn-success");
                            my_div.addClass("btn btn-secondary");
                            my_div.text('Subscribed');
                        }
                        alert(data.message) 
                       
                      
                    }
                    else{
                        alert(data.message)        
                    }
                });
            }

            </script>

            <script>
                function Disliked(event_id){
                  
                  
                   fetch("{% url 'like-fetcher' %}", {
                    method: 'post',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',"X-CSRFToken":token
                    },
                    body: JSON.stringify({
                        "event_id":event_id,
                        "action":"dislike",
                   
               
                                    })
                    }).then(function(res){ return res.json(); })
                    .then(function(data){          
                        if(data.data=="True"){
                         alert("done")
                           
                          
                        }
                        else{
                            alert(data.message)        
                        }
                    });
                }
    
                </script>

    </body>
</html>
